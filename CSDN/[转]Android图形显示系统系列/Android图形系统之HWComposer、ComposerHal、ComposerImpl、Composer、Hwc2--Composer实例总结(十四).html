åŸæ–‡  <a href=https://unbroken.blog.csdn.net/article/details/134142730>Androidå›¾å½¢ç³»ç»Ÿä¹‹HWComposerã€ComposerHalã€ComposerImplã€Composerã€Hwc2--Composerå®ä¾‹æ€»ç»“(åå››)</a><br>
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"/>
                    </svg>
                    <p><font color="red" size="3"> <strong>ç®€ä»‹ï¼š</strong></font><font color="blue" size="3"> <strong>CSDNåšå®¢ä¸“å®¶ï¼Œä¸“æ³¨Android/Linuxç³»ç»Ÿï¼Œåˆ†äº«å¤šmicè¯­éŸ³æ–¹æ¡ˆã€éŸ³è§†é¢‘ã€ç¼–è§£ç ç­‰æŠ€æœ¯ï¼Œä¸å¤§å®¶ä¸€èµ·æˆé•¿ï¼</strong></font></p> 
<p><font color="red" size="3"> <strong>ä¼˜è´¨ä¸“æ ï¼š</strong></font><a href="https://blog.csdn.net/u010164190/category_9599435.html"><strong>Audioå·¥ç¨‹å¸ˆè¿›é˜¶ç³»åˆ—</strong></a>ã€<strong>åŸåˆ›å¹²è´§æŒç»­æ›´æ–°ä¸­â€¦â€¦</strong>ã€‘ğŸš€</p> 
<p><font color="red" size="3"> <strong>äººç”Ÿæ ¼è¨€ï¼š</strong> </font> <font color="blue" size="3"><strong>äººç”Ÿä»æ¥æ²¡æœ‰æ·å¾„ï¼Œåªæœ‰è¡ŒåŠ¨æ‰æ˜¯æ²»ç–—ææƒ§å’Œæ‡’æƒ°çš„å”¯ä¸€è‰¯è¯.</strong></font></p> 
<center> 
 <font color="red" size="5"> æ›´å¤šåŸåˆ›,æ¬¢è¿å…³æ³¨ï¼šAndroidç³»ç»Ÿæ”»åŸç‹®</font> 
</center> 
<p><img src="https://img-blog.csdnimg.cn/20190106163945739.jpg#pic_center" alt="æ¬¢è¿å…³æ³¨Androidç³»ç»Ÿæ”»åŸç‹®"/></p> 
<h3><a id="1_12"/>1.å‰è¨€</h3> 
<blockquote> 
 <p>æœ¬ç¯‡ç›®çš„ï¼šAndroidå›¾å½¢ç³»ç»Ÿä¸­ï¼ŒHWCç‰¹åˆ«çš„å¤æ‚ï¼Œç‰¹åˆ«æ˜¯HWComposerã€ComposerImplã€Composerã€Hwc2::Composerä¹‹é—´çš„å…³ç³»ï¼Œæœ‰ç§å‰ªä¸æ–­ç†è¿˜ä¹±çš„æ„Ÿè§‰ï¼Œé€šè¿‡å‡ ä¸ªæ¼”åŒ–ä¾‹å­ï¼Œçœ‹æ¸…æ¥šå®ƒæœ¬æ¥çš„é¢ç›®ã€‚</p> 
</blockquote> 
<h3><a id="2HWComposerComposerImplComposerHwc2Composer_16"/>2.HWComposerã€ComposerImplã€Composerã€Hwc2::Composerå®šä¹‰ä¸å®ç°</h3> 
<h4><a id="1HWComposer_17"/>1.HWComposerå®ç°</h4> 
<p>frameworks/native/services/surfaceflinger/DisplayHardware/HWComposer.h</p> 
<h5><a id="1androidHWComposer_19"/><1>.android::HWComposerå®šä¹‰</h5> 
<pre><code class="prism language-cpp"><span class="token keyword">namespace</span> Hwc2 <span class="token punctuation">{
   <!-- --></span>
<span class="token keyword">class</span> <span class="token class-name">Composer</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">namespace</span> android <span class="token punctuation">{
   <!-- --></span>
<span class="token keyword">class</span> <span class="token class-name">HWComposer</span> <span class="token punctuation">{
   <!-- --></span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">HWComposer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">setCallback</span><span class="token punctuation">(</span>HWC2<span class="token double-colon punctuation">::</span>ComposerCallback<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2implHWComposerandroidHWComposer_34"/><2>.impl::HWComposerå®šä¹‰(ç»§æ‰¿è‡ªandroid::HWComposer)</h5> 
<pre><code class="prism language-cpp"><span class="token keyword">namespace</span> impl <span class="token punctuation">{
   <!-- --></span>

<span class="token keyword">class</span> <span class="token class-name">HWComposer</span> <span class="token keyword">final</span> <span class="token operator">:</span> <span class="token keyword">public</span> android<span class="token double-colon punctuation">::</span>HWComposer <span class="token punctuation">{
   <!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">HWComposer</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator"><</span>Hwc2<span class="token double-colon punctuation">::</span>Composer<span class="token operator">></span> composer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">explicit</span> <span class="token function">HWComposer</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&</span> composerServiceName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">~</span><span class="token function">HWComposer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="3implHWComposer_48"/><3>.impl::HWComposerå®ç°</h5> 
<p>frameworks/native/services/surfaceflinger/DisplayHardware/HWComposer.cpp</p> 
<pre><code class="prism language-cpp"><span class="token keyword">namespace</span> impl <span class="token punctuation">{
   <!-- --></span>
	<span class="token class-name">HWComposer</span><span class="token double-colon punctuation">::</span><span class="token function">HWComposer</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator"><</span>Hwc2<span class="token double-colon punctuation">::</span>Composer<span class="token operator">></span> composer<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">mComposer</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>composer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">mMaxVirtualDisplayDimension</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator"><</span>size_t<span class="token operator">></span></span></span><span class="token punctuation">(</span>sysprop<span class="token double-colon punctuation">::</span><span class="token function">max_virtual_display_dimension</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">mUpdateDeviceProductInfoOnHotplugReconnect</span><span class="token punctuation">(</span>
                sysprop<span class="token double-colon punctuation">::</span><span class="token function">update_device_product_info_on_hotplug_reconnect</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{
   <!-- --></span><span class="token punctuation">}</span>

<span class="token class-name">HWComposer</span><span class="token double-colon punctuation">::</span><span class="token function">HWComposer</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&</span> composerServiceName<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">HWComposer</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator"><</span>Hwc2<span class="token double-colon punctuation">::</span>impl<span class="token double-colon punctuation">::</span>Composer<span class="token operator">></span></span></span><span class="token punctuation">(</span>composerServiceName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{
   <!-- --></span><span class="token punctuation">}</span>

<span class="token class-name">HWComposer</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">HWComposer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{
   <!-- --></span>
    mDisplayData<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>HWComposeræ„é€ å‡½æ•°é€šè¿‡å®ƒçš„å§”æ‰˜æ„é€ å‡½æ•°ï¼Œé€šè¿‡std::make_uniqueHwc2::impl::Composer(composerServiceName)å®ä¾‹ç”»ï¼Œé‚£ä¹ˆHwc2::impl::Composerçš„å®ç°åœ¨å“ªå‘¢ï¼Ÿ</p> 
</blockquote> 
<h4><a id="2ComposerImplHwc2Composer_67"/>2.ComposerImplå®ç°ï¼ˆHwc2::Composeræ˜¯å®ƒçš„åˆ«åï¼‰</h4> 
<p>hardware/interfaces/graphics/composer/2.1/utils/hal/include/composer-hal/2.1/Composer.h</p> 
<h5><a id="1ComposerComposerImpl_69"/><1>.Composerå®šä¹‰ï¼Œå®ƒæ˜¯ComposerImplçš„åˆ«å</h5> 
<pre><code class="prism language-cpp"><span class="token keyword">using</span> Composer <span class="token operator">=</span> detail<span class="token double-colon punctuation">::</span>ComposerImpl<span class="token operator"><</span>IComposer<span class="token punctuation">,</span> ComposerHal<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">template</span> <span class="token operator"><</span><span class="token keyword">typename</span> <span class="token class-name">Interface</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">Hal</span><span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">ComposerImpl</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Interface</span></span> <span class="token punctuation">{
   <!-- --></span>
   <span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator"><</span>ComposerImpl<span class="token operator">></span> <span class="token function">create</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator"><</span>Hal<span class="token operator">></span> hal<span class="token punctuation">)</span> <span class="token punctuation">{
   <!-- --></span>
        </code></pre>
                </div>
                